## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
## Loading some data to test things out.
load("test-data.RData")
## Some start values: D = 0.1, g0 = 0.5, sigma = 50.
par.start <- c(log(0.1), qlogis(0.5), log(50))
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
par.start
scr.nll(par.start, test.data$bin.capt, test.data$traps, test.data$mask)
library(spatstat)
library(secr)
library(scr)
library(spatstat)
scr.nll <- function(pars, capt, traps, mask){
## Unlinking parameters
D <- exp(pars[1])
g0 <- plogis(pars[2])
sigma <- exp(pars[3])
## Number of animals detected.
n <- nrow(capt)
## Number of traps.
n.traps <- nrow(traps)
## Number of mask points.
n.mask <- nrow(mask)
## Area of a single mask pixel.
a <- attr(mask, "area")
## Constructing a distance matrix. The element (i, j) gives the
## distance between the ith mask point and the jth trap.
mask.dists <- crossdist(mask[, 1], mask [, 2],
traps[, 1], traps[, 2])
## Constructing a detection probability matrix. The element (i, j)
## gives the probability of an animal located at the ith mask
## point being detected at the jth trap.
mask.probs <- g0*exp(-mask.dists^2/(2*sigma^2))
## Constructing a detection probability vector. The ith element
## gives the probability of an animal located at the ith mask
## point being detected by *at least one* trap.
p.avoid <- apply(1 - mask.probs, 1, prod)
p.det <- 1 - p.avoid
##Calculating likelihood contribution due to each
## detected animal's capture history.
f.capt <- numeric(n)
for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
## Loading some data to test things out.
load("test-data.RData")
## Some start values: D = 0.1, g0 = 0.5, sigma = 50.
par.start <- c(log(0.1), qlogis(0.5), log(50))
fit <- optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
## Some start values: D = 0.1, g0 = 0.5, sigma = 50.
par.start <- c(log(0.1), qlogis(0.5), log(50))
fit <- optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
testcapt = test.data$capt
testtrap = test.data$traps
testmask = test.data$mask
colnames(testtrap) = c("x", "y")
testtrap = read.traps(data = data.frame(testID = 1:nrow(testtrap), testtrap), detector = "count")
testmask = make.mask(testtrap, type = "trapbuffer", buffer = 10 * 5)
testcapt = toCapthist(testcapt)
testcapt = make.capthist(testcapt, testtrap, fmt = "trapID")
testfit = secr.fit(testcapt, mask = testmask, detectfn = "HN")
coef(testfit)
?make.mask
testcapt = test.data$capt
testtrap = test.data$traps
testmask = test.data$mask
colnames(testtrap) = c("x", "y")
testtrap = read.traps(data = data.frame(testID = 1:nrow(testtrap), testtrap), detector = "count")
testmask = make.mask(testtrap)#, type = "trapbuffer", buffer = 10 * 5)
testcapt = toCapthist(testcapt)
testcapt = make.capthist(testcapt, testtrap, fmt = "trapID")
testfit = secr.fit(testcapt, mask = testmask, detectfn = "HN")
coef(testfit)
testcapt = test.data$capt
testtrap = test.data$traps
testmask = test.data$mask
colnames(testtrap) = c("x", "y")
testtrap = read.traps(data = data.frame(testID = 1:nrow(testtrap), testtrap), detector = "proximity")
testmask = make.mask(testtrap)#, type = "trapbuffer", buffer = 10 * 5)
testcapt = toCapthist(testcapt)
testcapt = make.capthist(testcapt, testtrap, fmt = "trapID")
testfit = secr.fit(testcapt, mask = testmask, detectfn = "HN")
testcapt = test.data$bin.capt
testtrap = test.data$traps
testmask = test.data$mask
colnames(testtrap) = c("x", "y")
testtrap = read.traps(data = data.frame(testID = 1:nrow(testtrap), testtrap), detector = "proximity")
testmask = make.mask(testtrap)#, type = "trapbuffer", buffer = 10 * 5)
testcapt = toCapthist(testcapt)
testcapt = make.capthist(testcapt, testtrap, fmt = "trapID")
testfit = secr.fit(testcapt, mask = testmask, detectfn = "HN")
coef(testfit)
predict(testfit)
testfit
exp(fit$par[1])
attributes(test.data)
class(test.data$mask0
class(test.data$mask)
testcapt = test.data$bin.capt
testtrap = test.data$traps
testmask = test.data$mask
colnames(testtrap) = c("x", "y")
?read.traps
testtrap = read.traps(data = testtrap, detector = "proximity")
testtrap
colnames(testtrap) = c("trapID", "x", "y")
load("wolverine.rda")
load("~/Business/University/Master's/Project/scrbook data/wolverine.rda")
traps = (wolverine$wtraps[, 1:3])
traps
testtrap = cbind(1:nrow(testtrap), testtrap)
testtrap
colnames(testtrap) = c("trapID", "x", "y")
testtrap = read.traps(data = testtrap, detector = "proximity")
?read.trap
?read.traps
## A required package.
library(spatstat)
?plogis\
?plogis
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
scr_nll
scr_nll(pars = c(1, 2))\
scr_nll(pars = c(1, 2))
scr_nll(pars = c(1, 2), matrix(c(1, 1)), matrix(c(1, 1)), matrix(c(1,1)))
1 / (1 + exp(2))
exp(1)
exp(1) * (1 / (1 + exp(2)))
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
scr_nll(c(1, 2))
Rcpp::sourceCpp('src/scr-fit.cpp')
scr_nll(c(1, 2))
load("test-data.RData")
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
library(secr)
library(scr)
library(spatstat)
## A required package.
library(spatstat)
## Computes the negative log-likelihood function for a simple SCR
## model.
##
## Arguments are as follows:
##
## pars: A vector of parameters at which to compute the
##       log-likelihood. They should appear in the following order:
##       (1) log(D), (2) logit(g0), (3) log(sigma).
##
## capt: Matrix of capture histories.
##
## traps: Matrix containing x- and y-coordinates of trap locations.
##
## mask: Matrix containing x- and y-coordinates of mask point
##       locations. Needs to have attribute 'area', providing the area
##       of a single pixel.
scr.nll <- function(pars, capt, traps, mask){
## Unlinking parameters
D <- exp(pars[1])
g0 <- plogis(pars[2])
sigma <- exp(pars[3])
## Number of animals detected.
n <- nrow(capt)
## Number of traps.
n.traps <- nrow(traps)
## Number of mask points.
n.mask <- nrow(mask)
## Area of a single mask pixel.
a <- attr(mask, "area")
## Constructing a distance matrix. The element (i, j) gives the
## distance between the ith mask point and the jth trap.
mask.dists <- crossdist(mask[, 1], mask [, 2],
traps[, 1], traps[, 2])
## Constructing a detection probability matrix. The element (i, j)
## gives the probability of an animal located at the ith mask
## point being detected at the jth trap.
mask.probs <- g0*exp(-mask.dists^2/(2*sigma^2))
## Constructing a detection probability vector. The ith element
## gives the probability of an animal located at the ith mask
## point being detected by *at least one* trap.
p.avoid <- apply(1 - mask.probs, 1, prod)
p.det <- 1 - p.avoid
##Calculating likelihood contribution due to each
## detected animal's capture history.
f.capt <- numeric(n)
for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
par.start <- c(log(0.1), qlogis(0.5), log(50))
fit <- optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
library(roxygen2)
roxygenise()
library(scr)
scr.nll
roxygenise()
library(scr)
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
par.start <- c(log(0.1), qlogis(0.5), log(50))
scr.nll(par.start, test.data$bin.capt, test.data$traps, test.data$mask)
debug(scr.nll)
scr.nll(par.start, test.data$bin.capt, test.data$traps, test.data$mask)
library(scr)
scr.nll(par.start, test.data$bin.capt, test.data$traps, test.data$mask)
optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
fit <- optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
##       locations. Needs to have attribute 'area', providing the area
##       of a single pixel.
scr.nllRAW <- function(pars, capt, traps, mask){
## Unlinking parameters
D <- exp(pars[1])
g0 <- plogis(pars[2])
sigma <- exp(pars[3])
## Number of animals detected.
n <- nrow(capt)
## Number of traps.
n.traps <- nrow(traps)
## Number of mask points.
n.mask <- nrow(mask)
## Area of a single mask pixel.
a <- attr(mask, "area")
## Constructing a distance matrix. The element (i, j) gives the
## distance between the ith mask point and the jth trap.
mask.dists <- crossdist(mask[, 1], mask [, 2],
traps[, 1], traps[, 2])
## Constructing a detection probability matrix. The element (i, j)
## gives the probability of an animal located at the ith mask
## point being detected at the jth trap.
mask.probs <- g0*exp(-mask.dists^2/(2*sigma^2))
## Constructing a detection probability vector. The ith element
## gives the probability of an animal located at the ith mask
## point being detected by *at least one* trap.
p.avoid <- apply(1 - mask.probs, 1, prod)
p.det <- 1 - p.avoid
##Calculating likelihood contribution due to each
## detected animal's capture history.
f.capt <- numeric(n)
for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
fit <- optim(par.start, scr.nllRAW, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
library(spatstat)
fit <- optim(par.start, scr.nllRAW, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
fit2 <- optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
?dbinom
dbinom(1, 1, 0.5)
dbinom(1, 1, 0.75)
dbinom(0.314, 1, 0.5)
dbinom(20, 1, 0.5)
dbinom(10, 1, 0.5)
dbinom(3, 1, 0.5)
dbinom(3, 10, 0.5)
dbinom(3, 10, 0.5)
choose(10, 3) * 0.5^3 * (1 - 0.5)^(10 - 3)
dbinom(3, 10, 0.5, log = TRUE)
log(choose(10, 3)) + 3 * log(0.5) + (10 - 3) * log(1 - 0.5)
366000+1704000+1373000
file.exists("~/.ssh/id_rsa.pub")
library(secr)
secr.fit
debug(secr.fit)
testcapt = test.data$bin.capt
testtrap = test.data$traps
testmask = test.data$mask
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
testcapt = test.data$bin.capt
testtrap = test.data$traps
testmask = test.data$mask
secr.fit(testcapt, mask = testmask, detectfn = "HN")
library(scr)
undebug(secr)
undebug(secr.fit)
scr.sim
scr.nll
secr.fit(testcapt, mask = testmask, detectfn = "HN")
make.capthist(testcapt, testtrap, fmt = "trapID")
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
testcapt = test.data$bin.capt
testtrap = test.data$traps
testmask = test.data$mask
par.start <- c(log(0.1), qlogis(0.5), log(50))
library(scr)
library(spatstat)
library(secr)
optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
fit = optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
?optim
## A required package.
library(spatstat)
## Computes the negative log-likelihood function for a simple SCR
## model.
##
## Arguments are as follows:
##
## pars: A vector of parameters at which to compute the
##       log-likelihood. They should appear in the following order:
##       (1) log(D), (2) logit(g0), (3) log(sigma).
##
## capt: Matrix of capture histories.
##
## traps: Matrix containing x- and y-coordinates of trap locations.
##
## mask: Matrix containing x- and y-coordinates of mask point
##       locations. Needs to have attribute 'area', providing the area
##       of a single pixel.
scr.nll <- function(pars, capt, traps, mask){
## Unlinking parameters
D <- exp(pars[1])
g0 <- plogis(pars[2])
sigma <- exp(pars[3])
## Number of animals detected.
n <- nrow(capt)
## Number of traps.
n.traps <- nrow(traps)
## Number of mask points.
n.mask <- nrow(mask)
## Area of a single mask pixel.
a <- attr(mask, "area")
## Constructing a distance matrix. The element (i, j) gives the
## distance between the ith mask point and the jth trap.
mask.dists <- crossdist(mask[, 1], mask [, 2],
traps[, 1], traps[, 2])
## Constructing a detection probability matrix. The element (i, j)
## gives the probability of an animal located at the ith mask
## point being detected at the jth trap.
mask.probs <- g0*exp(-mask.dists^2/(2*sigma^2))
## Constructing a detection probability vector. The ith element
## gives the probability of an animal located at the ith mask
## point being detected by *at least one* trap.
p.avoid <- apply(1 - mask.probs, 1, prod)
p.det <- 1 - p.avoid
##Calculating likelihood contribution due to each
## detected animal's capture history.
f.capt <- numeric(n)
for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
debug(scr.nll)
## Some start values: D = 0.1, g0 = 0.5, sigma = 50.
par.start <- c(log(0.1), qlogis(0.5), log(50))
fit <- optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
log.f.capt.given.s
dim(log.f.capt.given.s)
class(log.f.capt.given.s)
capt
mask.probs
class(mask.probs)
dim(mask.probs)
rm(scr.nll)
library(scr)
scr.fit(testcapt, testtrap, testmask, start = par.start)
library(roxygen2)
roxygenise()
scr.fit(testcapt, testtrap, testmask, start = par.start)
scr.fit(testcapt, testtrap, testmask, start = par.start)
library(scr)
scr.fit(testcapt, testtrap, testmask, start = par.start)
