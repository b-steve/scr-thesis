for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
debug(scr.nll)
## Some start values: D = 0.1, g0 = 0.5, sigma = 50.
par.start <- c(log(0.1), qlogis(0.5), log(50))
fit <- optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
log.f.capt.given.s
dim(log.f.capt.given.s)
class(log.f.capt.given.s)
capt
mask.probs
class(mask.probs)
dim(mask.probs)
rm(scr.nll)
library(scr)
scr.fit(testcapt, testtrap, testmask, start = par.start)
library(roxygen2)
roxygenise()
scr.fit(testcapt, testtrap, testmask, start = par.start)
scr.fit(testcapt, testtrap, testmask, start = par.start)
library(scr)
scr.fit(testcapt, testtrap, testmask, start = par.start)
library(scr)
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
par.start <- c(log(0.1), qlogis(0.5), log(50))
library(scr)
optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
scr.fit
scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)
library(roxygen2)
?scr.sim
?secr.fit
library(secr)
?secr.fit
roxygenise()
?scr.fit
library(scr)
scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)
library(scr)
scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)
roxygenise()
library(scr)
?scr
??scr
roxygenise()
library(scr)
?scr.fit
?scr.sim
secr.fit(testcapt, mask = testmask, detectfn = "HN")
testfit = secr.fit(test.data$bin.capt, mask = test.data$mask, detectfn = "HN")
make.capthist(test.data$bin.capt, test.data$traps)
make.capthist(data = test.data$bin.capt, test.data$traps)
?make.capthist
?read.traps
read.traps(data = test.data$traps)
testcapt = test.data$bin.capt
testtrap = test.data$traps
testmask = test.data$mask
testtrap = data.frame(cbind(1:nrow(testtrap), testtrap))
colnames(testtrap) = c("trapID", "x", "y")
testtrap = read.traps(data = testtrap, detector = "proximity")
testmask = make.mask(testtrap)#, type = "trapbuffer", buffer = 10 * 5)
testcapt = toCapthist(testcapt)
testcapt = make.capthist(testcapt, testtrap, fmt = "trapID")
testfit = secr.fit(testcapt, mask = testmask, detectfn = "HN")
predict(testfit)
scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, par.start)
library(secr)
test.data
test.data$bin.capt
toCapthist(test.data$bin.capt)
library(Bhat)
plkhci(
)
plkhci
testcapt
class(testcapt)
class(testcapt) == "capthist"
attributes(testcapt)
testcapt[, 1, ]
class(testcapt[, 1, ])
?substitute
?switch
?dpois
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::depends
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
roxygenise()
Rcpp::sourceCpp('src/scr-fit.cpp')
install.package("RcppParallel")
install.packages("RcppParallel")
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
library(roxygen)
library(roxygen2)
roxygenise()
Rcpp::sourceCpp('src/scr-fit.cpp')
roxygenise()
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
install.packages("Rcpp")
install.packages("Rcpp")
library(installr)
updateR()
update.packages()
Rcpp::sourceCpp('src/scr.cpp')
Rcpp::sourceCpp('src/scr.cpp')
roxygenise()
library(roxygen2)
roxygenise()
Rcpp::sourceCpp('src/scr-fit.cpp')
roxygenise()
Rcpp::sourceCpp('src/scr-fit.cpp')
library(scr)
Rcpp::sourceCpp('~/Business/University/Master\'s/Project/Package/scr/src/scr-fit.cpp')
Rcpp::sourceCpp('~/Business/University/Master\'s/Project/Package/scr/src/scr-fit.cpp')
Rcpp::sourceCpp('~/Business/University/Master\'s/Project/Package/scr/src/scr-fit.cpp')
Rcpp::sourceCpp('~/Business/University/Master\'s/Project/Package/scr/src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
Rcpp::sourceCpp('src/scr-fit.cpp')
library(secr)
library(scr)
library(spatstat)
scr_nll
scr.nll
scr.fit
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
par.start <- c(log(0.1), qlogis(0.5), log(50))
?system.time
system.time(optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask))
scr.nllRAW <- function(pars, capt, traps, mask){
## Unlinking parameters
D <- exp(pars[1])
g0 <- plogis(pars[2])
sigma <- exp(pars[3])
## Number of animals detected.
n <- nrow(capt)
## Number of traps.
n.traps <- nrow(traps)
## Number of mask points.
n.mask <- nrow(mask)
## Area of a single mask pixel.
a <- attr(mask, "area")
## Constructing a distance matrix. The element (i, j) gives the
## distance between the ith mask point and the jth trap.
mask.dists <- crossdist(mask[, 1], mask [, 2],
traps[, 1], traps[, 2])
## Constructing a detection probability matrix. The element (i, j)
## gives the probability of an animal located at the ith mask
## point being detected at the jth trap.
mask.probs <- g0*exp(-mask.dists^2/(2*sigma^2))
## Constructing a detection probability vector. The ith element
## gives the probability of an animal located at the ith mask
## point being detected by *at least one* trap.
p.avoid <- apply(1 - mask.probs, 1, prod)
p.det <- 1 - p.avoid
##Calculating likelihood contribution due to each
## detected animal's capture history.
f.capt <- numeric(n)
for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
system.time(optim(par.start, scr.nllRAW, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask))
##       of a single pixel.
scr.nllRAW <- function(pars, capt, traps, mask){
## Unlinking parameters
D <- exp(pars[1])
g0 <- plogis(pars[2])
sigma <- exp(pars[3])
## Number of animals detected.
n <- nrow(capt)
## Number of traps.
n.traps <- nrow(traps)
## Number of mask points.
n.mask <- nrow(mask)
## Area of a single mask pixel.
a <- attr(mask, "area")
## Constructing a distance matrix. The element (i, j) gives the
## distance between the ith mask point and the jth trap.
mask.dists <- crossdist(mask[, 1], mask [, 2],
traps[, 1], traps[, 2])
## Constructing a detection probability matrix. The element (i, j)
## gives the probability of an animal located at the ith mask
## point being detected at the jth trap.
mask.probs <- g0*exp(-mask.dists^2/(2*sigma^2))
## Constructing a detection probability vector. The ith element
## gives the probability of an animal located at the ith mask
## point being detected by *at least one* trap.
p.avoid <- apply(1 - mask.probs, 1, prod)
p.det <- 1 - p.avoid
##Calculating likelihood contribution due to each
## detected animal's capture history.
f.capt <- numeric(n)
for (i in 1:n){
## Calculating the log-probability of the animal's capture
## history, conditional on being at the jth mask point.
log.f.capt.given.s <- numeric(n.mask)
for (j in 1:n.mask){
log.f.capt.given.s[j] <- sum(dbinom(capt[i, ], 1, mask.probs[j, ], log = TRUE))
}
## Summing the probabilities over all mask points.
f.capt[i] <- sum(exp(log.f.capt.given.s))
}
## Log-likelihood contribution from all capture histories
## calculated by the log of the sum of the individual likelihood
## contributions.
log.f.capt <- sum(log(f.capt + .Machine$double.xmin))
## Calculating the effective survey area (not used in likelihood here).
esa <- a*sum(p.det)
## Log-likelihood contribution from the number of animals
## detected.
log.f.n <- dpois(n, D*esa, log = TRUE)
## Overall log-likelihood. I can never remember where the last bit
## comes from, but you need it.
ll <- log.f.n + log.f.capt - n*log(sum(p.det))
## Returning negative log-likelihood.
-ll
}
system.time(optim(par.start, scr.nllRAW, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask))
library(scr)
scr.fit
system.time(optim(par.start, scr.nll, capt = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask))
library(scr)
?scr.fit
scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)
fit <- optim(par.start, scr.nll, caps = test.data$bin.capt, traps = test.data$traps, mask = test.data$mask)
## Unlinking estimates.
## D:
exp(fit$par[1])
## g0:
plogis(fit$par[2])
## sigma:
exp(fit$par[3])
tfit = scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)
exp(tfit$par[1])
tfit$par
tfit
exp(tfit[1])
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
library(scr)
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
library(scr)
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
traceback()
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
debug(scr.fit)
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
optim(start, scr.nll,
caps = capthist,
traps = traps,
mask = mask,
maskDists = maskDists)
?optim
scr.nll
library(scr)
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
library(scr)
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start))
replicate(system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)), 1000)/1000
?replicate
replicate(1000, system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)))/1000
replicate(100, system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)))/100
replicate(10, system.time(scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)))/10
system.time(replicate(10, scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)))/10
system.time(replicate(10, scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)))/10
library(scr)
system.time(replicate(10, scr.fit(test.data$bin.capt, test.data$traps, test.data$mask, start = par.start)))/10
library(scr)
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
scr.sim(5, 15, density = 7.5, test.data$traps)
scr.sim(5, 15, density = 7.5, test.data$traps, acoustic = TRUE)
scr.sim(3, 15, density = 7.5, test.data$traps, acoustic = TRUE)
library(scr)
?scr.sim
scr.sim(5, 15, test.data$traps)
scr.sim(5, 15, test.data$traps, density = 5)
scr.fit(scr.sim(5, 15, test.data$traps, density = 5), test.data$traps, test.data$mask, par.start)
scr.fit(scr.sim(5, 15, test.data$traps, density = 5), test.data$traps, test.data$mask, par.start)
?secr.fit
library(secr)
?secr.fit
?scr.sim
?scr.fit
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
rdistr("pois")
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
test(paste0("r", distr, "(length(d), lambda_0 * exp(-d^2 / (2 * sigma^2)))"))
test(paste0("r", "pois", "(length(d), lambda_0 * exp(-d^2 / (2 * sigma^2)))"))
test(paste0("r", "pois", "(9, lambda_0 * exp(-d^2 / (2 * sigma^2)))"))
test("rpois(1, 5)")
Rcpp::sourceCpp('src/scr-sim.cpp')
test("rpois(1, 5)")
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
test("rpois(1, 5)")
test(rpois(1, 5))
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
test(rpois(1, 5))
test("rpois(1, 5)")
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
test("rpois(1, 5)")
set.seed(2615527); rpois(1, 5)
set.seed(2615527); test("rpois(1, 5)")
set.seed(2615527); test("rpois(1, 5)")
set.seed(2615527); test("rpois(1, 5)")
set.seed(2615527); rpois(1, 5)
set.seed(2615527); rpois(1, 5)
Rcpp::sourceCpp('src/scr-sim.cpp')
set.seed(2615527); test("rpois(1, 5)")
set.seed(2615527); rpois(1, 5)
set.seed(26216565427); test("rpois(1, 5)")
set.seed(256416); test("rpois(1, 5)")
set.seed(256416); test("rpois(1, 5)")
set.seed(5); test("rpois(1, 5)")
set.seed(6); test("rpois(1, 5)")
set.seed(6); test("rpois(1, 5)")
set.seed(6); rpois(1, 5)
test("cat('penis')")
test("cat("penis")")
test("cat(\"penis\")")
Rcpp::sourceCpp('src/scr-sim.cpp')
test("cat(\"penis\")")
test("print('test worked')")
test("test")
rm(rdistr)
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
test("scr.sim(5, 15, test.data$traps)")
library(scr)
test("scr.sim(5, 15, test.data$traps)")
library(scr)
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
scr.sim(5, 15, test.data$traps)
scr.sim(5, 15, test.data$traps, acoustic = TRUE)
Rcpp::sourceCpp('src/scr-sim.cpp')
d = 10
parseEval("d * 10")
debug(scr.sim)
parseEval("d * 10")
scr.sim(5, 15, test.data$traps, acoustic = TRUE)
parseEval("lambda_0 * 10")
parseEval("lambda_0 * 10")
test = test.data$traps[1:5,]
test
rm(test)
rm(d)
Rcpp::sourceCpp('src/scr-sim.cpp')
parseEval("rpois(1, 5)")
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
parseEval("rpois(1, 5)")
parseEval()
parseEval("rpois")
debug(scr.sim)
scr.sim(5, 15, test.data$traps, acoustic = TRUE)
nrow(coords)
nrow(distances)
scr.sim(5, 15, test.data$traps, acoustic = TRUE)
t(replicate(lambda_0, parseEval(rDistr)))#
t(replicate(lambda_0, eval(parse(text = rDistr))))
eval(parse(text = rDistr))
eval(parse(text = rDistr))
eval(parse(text = rDistr))
library(scr)
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
scr.sim(5, 15, test.data$traps, acoustic = TRUE)
library(scr)
scr.sim(5, 15, test.data$traps, acoustic = TRUE)
scr.sim(5, 50, test.data$traps, acoustic = TRUE)
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
rDistr("pois")
rDistr("pois")
rDistr("pois")
rDistr("pois")
rDistr("pois")
rDistr("pois")
rDistr("pois")
rDistr("pois")
?rbinom
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
test("foobar")
test("foobar")
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
table(c(1, 1, 2, 2, 2, 1, 2, 2, 1, 1, 1, 2))
plot(exp(seq(1, 100, length = 1000)), type = "l")
plot(logit(seq(1, 100, length = 1000)), type = "l")
?logit
log(1 / 1 + exp(seq(1, 100, length = 1000)))
plot(log(1 / 1 + exp(seq(1, 100, length = 1000))), type = "l")
plot(log(1 / (1 - exp(seq(0, 1, length = 1000)))), type = "l")
log(1 / (1 - exp(seq(0, 1, length = 1000))))
log(seq(0, 1, length = 1000) / (1 - seq(0, 1, length = 1000)))
plot(log(seq(0, 1, length = 1000) / (1 - seq(0, 1, length = 1000))), type = "l")
plot((1 / 1 + exp(-seq(1, 100, length = 1000))), type = "l")
plot((1 / 1 + exp(-seq(-100, 100, length = 1000))), type = "l")
plot((1 / 1 + exp(-seq(-100, 100, length = 100000))), type = "l")
plot((exp(seq(-100, 100, length = 100000)) / 1 + exp(seq(-100, 100, length = 100000))), type = "l")
plot((exp(seq(-100, 100, length = 100000)) / (1 + exp(seq(-100, 100, length = 100000)))), type = "l")
plot((exp(seq(-100, 100, length = 100000)) / (1 + exp(seq(0, 1, length = 100000)))), type = "l")
plot((exp(seq(0, 1, length = 100000)) / (1 + exp(seq(0, 1, length = 100000)))), type = "l")
logit = function(x) exp(x)/(1 + exp(x))
logit(100)
logit(0)
logit(seq(0, 1, length = 10000)
)
plot(logit(seq(0, 1, length = 10000)), type = "l")
plot(logit(seq(-1, 1, length = 10000)), type = "l")
plot(logit(seq(-1000, 1000, length = 10000)), type = "l")
plot(logit(seq(-10, 10, length = 10000)), type = "l")
load("~/Business/University/Master's/Project/Likelihood/test-data.RData")
?rbinom
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
Rcpp::sourceCpp('src/scr-sim.cpp')
rdistr("pois", 5)
rdistr("pois", 5)
rdistr("pois", 5)
rdistr("pois", 5, prob = 0.5)
